# Bash
Командная оболочка Linux (является оболочкой по умолчанию в некоторых дистрибутивах, таких как Ubunty, Red Hat, CentOS).

Bash (Bourne Again SHell) — это мощная командная оболочка, которая предоставляет пользователям возможность выполнять команды, писать скрипты и автоматизировать задачи. В этом контексте важно рассмотреть несколько ключевых аспектов, таких как подстановка переменных, области видимости переменных, режимы работы, конструкции управления и использование команд.

Примеры:\
https://github.com/ruanyf/simple-bash-scripts \
https://github.com/djeada/Bash-Scripts

**Умеет**
- Выполнять команды
    - Простые (из одного действия и аргументов)
    - Сложные - несколько простых, объединённых через pipe (`|`), перенаправление ввода-вывода (`<`,  `>`, `>>`), условных операторов (`if/else`, `case/esac`, `while/do`)
- Автодополнение, история
- Скрипты - создание и запуск скриптов.

**Используется для**
- Автоматизации
- Настройки
- Сборки
- Тестирования
- Мониторинга
- Анализа
- И другого
## Основные команды

[Командная строка](cmd.md)

Последовательное выполнение команд:
```sh
# Последовательно исполняет команды
cmd1; cmd2; cmd3;

# Исполняет следующую команду только если прошлая завершилась с ненулевым кодом возврата
cmd1 || cmd2 || cmd3

# Исполняет следующую команду только если прошлая завершилась с нулевым кодом возврата
cmd1 && cmd2 && cmd3
```


## Синтаксис

### Переменные
```sh
# объявление
name="John"
age=30

# обращение
echo 'Hello, $name'
```

`name="John"; echo $name`\
`name="John"; echo '$name'
#### Подстановка переменных

В Bash подстановка переменных — это процесс замены имени переменной на её значение. Это достигается с помощью символа `$`, который указывает интерпретатору на необходимость извлечь значение переменной. Например, если переменная `VAR` содержит строку "Hello", то команда `echo $VAR` выведет "Hello"[1][5].
#### Форматы подстановки
- **Простая подстановка**: Использует `$VAR`.
- **Строгая подстановка**: Использует `${VAR}`, что позволяет избежать неоднозначностей, особенно когда за именем переменной следуют другие символы.

#### Типы переменных
1. *Локальные переменные*
    Видимы в скрипте или функции.\
    `name="John"; echo $name`

2. *Переменные окружения*
    Доступны всем дочерним процессам\
    `echo $USER`\
    `echo $PATH`\
    Чтобы сделать переменную окружения, используется команда `export`.\
     `export VAR="global"`
3. *Особые переменные*
    - $0 — имя текущего скрипта;
    - $1, $2, … — аргументы, переданные скрипту;
    - $? — код возврата последней выполненной команды.

#### Операции с переменными
- присваивание: `=`
- арифметические операции: `+`, `-`, `*`, `/`, `%`
- сравнение: `==`, `!=`, `<`, `>`, `<=`, `>=`.

### Типы данных

Хотя Bash не имеет строгой системы типов данных, как статически типизированные языки, он поддерживает несколько типов данных, которые могут быть использованы в скриптах.\
Перечислим их:
```sh
# Целые числа
a=10;
b=-5;

#
c=3.14;
d=5.5;

# Строки
s="Hello, World"
t='Bash scripting'

# Массивы
array=(1 2 3);
my_array["имя"]

# Словари (ассоциативные массивы)
declare -A assoc_array;
my_assoc_array["ключ"]="значение";

# Специальные переменные
echo $HOME
echo $PATH
echo $USER
```

#### Преобразование типов
Целое число в строку\
`echo $((10))`\
Строку в целое число\
`expr 10 + 5`

### Команда `[`

Команда `[` (или `test`) используется для проверки условий в конструкциях `if`, например:
```bash
if [ -f "file.txt" ]; then
    echo "File exists"
fi
```
Это команда Unix, которая возвращает статус выполнения в зависимости от результата проверки.

### Ветвления (if else)
`if`, `elif` и `else`
```bash
if [ "$VAR" = "value" ]; then
  echo "Condition met"
fi
```

```Bash
if [ condition ]; then
    # Выполнить, если условие истинно
elif [ condition ]; then
    # Выполнить, если условие истинно
else
    # Выполнить, если все предыдущие условия ложны
fi
```

```sh
if [ $age -gt 18 ]; then
    echo "Вы можете голосовать"
else
    echo "Вы не можете голосовать"
fi
```

### case
```sh
case $choice in
    "1")
        echo "Вы выбрали пункт 1"
        ;;
    "2")
        echo "Вы выбрали пункт 2"
        ;;
    *)
        echo "Вы ввели неверный пункт"
        ;;
esac
```
### Циклы
`man bash`\
`/while`

Цикл for:
```bash
for i in {1..5}; do
    echo "Number $i"
done
```

```Bash
for variable in list; do
    # Выполнить для каждого элемента в списке
done
```

Цикл while:
```sh
while [ "$VAR" -lt 10 ]; do
    VAR=$((VAR + 1))
done
```

```Bash
while condition; do
    # Выполнить, пока условие истинно
done
```

Цикл until:
```Bash
until condition; do
    # Выполнять, пока условие ложно
done
```

Примеры:
```Bash
# Вывести числа от 1 до 10
for i in $(seq 1 10); do
    echo $i
done
```

```Bash
# Выполнять до тех пор, пока не будет введен "q"
while true; do
    read input
    if [ $input == "q" ]; then
        break
    fi
done
```

### Функции
```Bash
function function_name() {
    # Код функции
}
```

Аргументы можно получить с помощью специальной переменной $1, $2 и т.д.\
Например:
```Bash
function greet() {
    echo "Привет, $1!"
}
greet John
```

`$ function greet(){echo "Hello, $1"}; greet John`

#### Возвращаемое значение - echo
Функции могут возвращать значения с помощью оператора echo.\
Возвращаемое значение можно получить с помощью $.

```Bash
my_function() {
    echo "First argument: $1"
    echo "Second argument: $2"
}

my_function hello world

sum() {
    echo $(($1 + $2))
}

sum 5 10;

result=$(sum 5 10);

echo $result;
```

#### Код возврата - return
В функциях bash оператор `return` используется для передачи кода возврата.\
return 0; => всё ок\
return 1; (как и любое ненулевое значение) => что-то сломалось

### Создание скрипта
```
$ echo $SHELL
/bin/bash

# Создаём скрипт
$ touch script.sh
# Делаем файл исполняемым
$ chmod +x script.sh
```

`script.sh`
```bash
#! /bin/bash

echo $USER
```

### Режимы работы в Bash

Bash поддерживает различные режимы работы, которые могут влиять на выполнение скриптов:

- **set -e**: Этот режим завершает выполнение скрипта при возникновении любой ошибки. Это полезно для предотвращения продолжения выполнения скрипта в случае неудачи.

- **set -x**: Включает режим отладки, при котором каждая команда выводится на экран перед выполнением. Это помогает отслеживать выполнение скрипта и выявлять ошибки.

## Пример активации virtualenv в Python

Для активации виртуального окружения Python можно использовать следующий скрипт:
```bash
#!/bin/bash

# Создание виртуального окружения
python3 -m venv myenv

# Активация виртуального окружения
source myenv/bin/activate

# Проверка активации
echo "Virtual environment activated"
```

## Команда shift и парсинг аргументов командной строки

Команда `shift` используется для сдвига позиционных параметров в Bash. При выполнении `shift`, все параметры сдвигаются на один влево, что позволяет обрабатывать аргументы командной строки по одному.

Пример скрипта для парсинга аргументов:
```bash
#!/bin/bash

while [ $# -gt 0 ]; do
    case "$1" in
        -a) echo "Option A";;
        -b) echo "Option B";;
        *) echo "Unknown option: $1";;
    esac
    shift # Сдвигаем параметры
done
```

Этот скрипт обрабатывает аргументы командной строки и выводит соответствующие сообщения в зависимости от переданных опций.

